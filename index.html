<!--
Copyright (C) 2025 0J (Lin Jie / 0rigin1856)

This file is part of 0riginAttendance-System.

0riginAttendance-System is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 2 of the License, or
(at your option) any later version.

0riginAttendance-System is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with 0riginAttendance-System. If not, see <https://www.gnu.org/licenses/>.
Please credit "0J (Lin Jie / 0rigin1856)" when redistributing or modifying this project.
-->


<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <link rel="icon" href="Attendance-System/0rigin.png" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title data-i18n="APP_TITLE">APP_TITLE</title>
    <link rel="stylesheet" href="./dist/compiled.css">

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const toggleButton = document.getElementById('theme-toggle');
            const htmlElement = document.documentElement; // 指向 <html> 標籤
            const themeIcon = document.getElementById('theme-icon'); // 取得圖標的元素

            // --- 核心函式：根據主題更新圖標 ---
            function updateThemeIcon() {
                if (htmlElement.classList.contains('dark')) {
                    themeIcon.textContent = '☀️';
                } else {
                    themeIcon.textContent = '🌙';
                }
            }

            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
            updateThemeIcon();

            // --- 2. 處理點擊事件 ---
            toggleButton.addEventListener('click', () => {
                // 切換 <html> 標籤上的 'dark' class
                htmlElement.classList.toggle('dark');

                // 將新的主題偏好保存到 localStorage
                if (htmlElement.classList.contains('dark')) {
                    localStorage.setItem('theme', 'dark');
                } else {
                    localStorage.setItem('theme', 'light');
                }

                // 💡 點擊後更新圖標狀態
                updateThemeIcon();
            });
        });
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
</head>

<body class="flex items-center justify-center min-h-screen p-4 
             bg-white dark:bg-gray-900 
             text-gray-900 dark:text-gray-100">
    <div id="app-container" class="w-full max-w-md mx-auto">
        <!-- User Profile & Header -->
        <header id="user-header" class="flex items-center justify-between p-4 mb-6 card fade-in" style="display: none;">

            <div class="flex items-center space-x-3">
                <img id="profile-img" src="https://placehold.co/40x40/e0e0e0/757575?text=U" alt="頭像"
                    class="w-10 h-10 rounded-full">
                <div>
                    <p id="user-name" class="font-semibold">使用者名稱</p>
                    <p id="welcome-mes" data-i18n="WELCOME_BACK" class="text-xs text-gray-500">歡迎回來！</p>
                </div>
            </div>

            <div class="flex flex-col items-end space-y-2">


                <div class="flex items-center space-x-3">
                    <button id="logout-btn" data-i18n="BTN_LOGOUT"
                        class="text-sm font-medium text-gray-600 hover:text-indigo-600 dark:text-gray-400 dark:hover:text-indigo-400">登出</button>
                    <button id="theme-toggle"
                        class="p-2 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200">
                        <span id="theme-icon">🌙</span>
                    </button>
                </div>
                <select id="language-switcher"
                    class="text-sm font-medium text-gray-600 rounded-md p-1 dark:text-gray-300 dark:bg-gray-700 max-w-xs">
                    <option value="zh-TW">繁體中文</option>
                    <option value="en-US">English</option>
                    <option value="id">Bahasa Indonesia</option>
                    <option value="vi">Tiếng Việt</option>
                    <option value="ja">日本語</option>
                </select>

            </div>

        </header>

        <!-- Login Section -->
        <section id="login-section" class="text-center p-8 card fade-in">
            <img src="/Attendance-System/0rigin.png" alt="打卡系統橫幅圖" class="main-image">
            <h1 id="appTitle" data-i18n="SUBTITLE_LOGIN" class="text-2xl font-bold text-gray-800 mb-2 dark:text-white">
                歡迎文輝考勤系統</h1>
            <p class="text-gray-600 mb-6" data-i18n="LOGIN_INFO" id="status">請點擊登入以繼續。</p>
            <div id="login" class="space-y-4">
                <button id="login-btn" data-i18n="BTN_LOGOIN" class="w-full py-3 px-4 rounded-lg font-bold btn-primary"
                    style="display: none;">使用LINE登入</button>
            </div>
        </section>

        <!-- Main App Content -->
        <div id="main-app" class="fade-in" style="display: none;">
            <!-- Tab Navigation -->
            <div class="flex justify-center space-x-2 mb-6">
                <button id="tab-dashboard-btn" data-i18n="TAB_DASHBOARD"
                    class="py-2 px-4 rounded-full font-bold text-sm text-white bg-indigo-600">儀表板</button>
                <button id="tab-monthly-btn" data-i18n="TAB_MONTHLY"
                    class="py-2 px-4 rounded-full font-bold text-sm text-gray-600 bg-gray-200">月份檢視</button>
                <button id="tab-Form-btn" data-i18n="TAB_FORM" style="display: none;"
                    class="py-2 px-4 rounded-full font-bold text-sm text-gray-600 bg-gray-200">表單申請</button>
                <button id="tab-location-btn" data-i18n="TAB_LOCATION"
                    class="py-2 px-4 rounded-full font-bold text-sm text-gray-600 bg-gray-200"
                    style="display: none">定位</button>
                <button id="tab-admin-btn" data-i18n="TAB_ADMIN"
                    class="py-2 px-4 rounded-full font-bold text-sm text-gray-600 bg-gray-200" style="display: none"
                    ;>管理員</button>
            </div>

            <!-- Dashboard View -->
            <main id="dashboard-view" class="space-y-6">
                <div class="card p-6">
                    <h2 data-i18n="PUNCH_SECTION_TITLE" class="text-xl font-bold text-gray-800 dark:text-white mb-1">
                        打卡專區
                    </h2>
                    <p data-i18n="PUNCH_SECTION_DESCRIPTION" class="text-gray-500 mb-4">請點擊下方按鈕進行上班或下班打卡。</p>

                    <!-- 將地圖與定位狀態移到按鈕上方 -->
                    <div class="mt-4 mb-6">
                        <div id="map-container"
                            class="w-full h-64 rounded-lg mb-4 bg-gray-200 flex items-center justify-center text-gray-500">
                            <div id="map-loading-text">
                                <span data-i18n="MAP_LOADING">正在載入地圖...</span>
                            </div>
                        </div>
                        <div class="bg-gray-50 p-4 dark:bg-gray-700 rounded-lg">
                            <p class="text-sm text-gray-600 dark:text-white">
                                <strong data-i18n="LOCATION_STATUS_LABEL">狀態：</strong>
                                <span id="location-status" ata-i18n="LOCATION_STATUS_PENDING">未偵測</span>
                            </p>
                            <p class="text-sm text-gray-600">
                                <strong data-i18n="COORDINATES_LABEL">經緯度：</strong>
                                <span id="location-coords" data-i18n="COORDINATES_UNKNOWN">未知</span>
                            </p>
                        </div>
                    </div>

                    <div id="punch-actions" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <button id="punch-in-btn" data-i18n="PUNCH_IN_LABEL"
                            class="w-full py-3 px-4 rounded-lg font-bold btn-primary">上班打卡</button>
                        <button id="punch-out-btn" data-i18n="PUNCH_OUT_LABEL"
                            class="w-full py-3 px-4 rounded-lg font-bold btn-secondary">下班打卡</button>
                    </div>
                    <a href="https://lin.ee/Tt12P5g" target="_blank"
                        class="p-4 flex items-center justify-center font-bold text-white rounded-lg shadow-lg transition duration-150 mt-6"
                        style="
                            text-decoration: none; 
                            background-color: #00B900; /* LINE 較標準的綠色 */
                            box-shadow: 0 4px #009900; /* 增加立體感 */
                            display: none;
                        ">
                        <span class="mr-2 text-xl">💬</span>
                        加入員工 LINE 頻道，掌握最新公告！
                    </a>
                </div>

                <div id="abnormal-records-section" class="card p-6" style="display: none;">
                    <h2 data-i18n="ABNORMAL_RECORDS_TITLE"
                        class="text-xl font-bold text-gray-800 mb-1  dark:text-white mb-1">考勤紀錄</h2>
                    <p data-i18n="ABNORMAL_RECORDS_DESCRIPTION" class="text-gray-500 mb-4">系統會自動偵測本月異常紀錄，您可以在此進行補打卡。</p>
                    <div id="abnormal-records-container">
                        <div id="records-loading" data-i18n="RECORDS_LOADING" class="text-center text-gray-500 py-4">
                            正在載入紀錄...</div>
                        <div id="records-empty" class="text-center text-green-600 bg-green-50 p-4 rounded-lg"
                            style="display: none;">
                            <p data-i18n="RECORDS_EMPTY_TITLE" class="font-semibold">太棒了！</p>
                            <p data-i18n="RECORDS_EMPTY_MESSAGE">本月目前沒有任何異常紀錄。</p>
                        </div>
                        <ul id="abnormal-list" class="space-y-3"></ul>
                    </div>
                    <div id="adjustment-form-container" class="mt-4"></div>
                </div>
            </main>

            <!-- Monthly View -->
            <section id="monthly-view" class="space-y-6" style="display: none;">
                <div class="card p-6">
                    <div class="flex justify-between items-center mb-4">
                        <button id="prev-month" class="text-gray-600 p-2 rounded-full hover:bg-gray-100">◄</button>
                        <div class="flex items-center justify-between">
                            <h3 id="month-title" class="font-bold text-xl text-gray-800 dark:text-white mb-1"></h3>
                            <button id="refresh-month"
                                class="text-gray-600 p-2 rounded-full hover:bg-gray-100">↻</button>
                        </div>
                        <button id="next-month" class="text-gray-600 p-2 rounded-full hover:bg-gray-100">►</button>
                    </div>
                    <div class="grid grid-cols-7 text-center text-sm font-semibold text-gray-500 mb-2">
                        <span data-i18n="WEEK_SUNDAY">日</span>
                        <span data-i18n="WEEK_MONDAY">一</span>
                        <span data-i18n="WEEK_TUESDAY">二</span>
                        <span data-i18n="WEEK_WEDNESDAY">三</span>
                        <span data-i18n="WEEK_THURSDAY">四</span>
                        <span data-i18n="WEEK_FRIDAY">五</span>
                        <span data-i18n="WEEK_SATURDAY">六</span>
                    </div>
                    <div id="calendar-grid" class="grid grid-cols-7 gap-1"></div>
                </div>

                <div id="daily-records-card" class="card p-6" style="display: none;">
                    <h4 id="daily-records-title" class="text-xl font-bold text-gray-800 mb-2 dark:text-white mb-1"></h4>
                    <ul id="daily-records-list" class="space-y-3"></ul>
                    <div id="daily-records-empty" data-i18n="DAILY_RECORDS_EMPTY" class="text-center text-gray-500 py-4"
                        style="display: none;">
                        該日沒有打卡紀錄。
                    </div>
                </div>
            </section>

            <!-- Location View -->
            <section id="location-view" class="space-y-6" style="display: none;">
                <div class="card p-6">
                    <h2 data-i18n="CURRENT_LOCATION_TITLE"
                        class="text-xl font-bold text-gray-800 mb-1 dark:text-white mb-1">當前位置</h2>
                    <p data-i18n="CURRENT_LOCATION_DESCRIPTION" class="text-gray-500 mb-4">系統將透過 GPS 偵測您的位置。</p>

                    <!-- <div id="map-container"
                        class="w-full h-64 rounded-lg mb-4 bg-gray-200 flex items-center justify-center text-gray-500">
                        <div id="map-loading-text">
                            <span data-i18n="MAP_LOADING">正在載入地圖...</span>
                        </div>
                    </div>
                    <div class="bg-gray-50 p-4 dark:bg-gray-700 rounded-lg">
                        <p class="text-sm text-gray-600 dark:text-white">
                            <strong data-i18n="LOCATION_STATUS_LABEL">狀態：</strong>
                            <span id="location-status" ata-i18n="LOCATION_STATUS_PENDING">未偵測</span>
                        </p>
                        <p class="text-sm text-gray-600">
                            <strong data-i18n="COORDINATES_LABEL">經緯度：</strong>
                            <span id="location-coords" data-i18n="COORDINATES_UNKNOWN">未知</span>
                        </p>
                    </div> -->
                </div>
            </section>
            <!-- Form View -->
            <section id="Form-view" class="space-y-6" style="display: none;">
                <div class="card p-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-1 dark:text-white mb-1">
                        未解鎖功能</h2>
                    <p class="text-gray-500 mb-4">請聯絡開發人員</p>
                </div>
            </section>



            </section>

            <!-- Admin View -->

            <section id="admin-view" class="space-y-6" style="display: none;">

                <!-- Tab Navigation -->
                <div class="card p-3 ">
                    <div class="flex justify-center space-x-2">
                        <!-- 1. 員工管理  -->
                        <button id="tab-employee-mgmt-btn" data-i18n="TAB_EMPLOYEE_MGMT"
                            class="py-2 px-4 rounded-full font-bold text-sm text-white bg-indigo-600">員工管理</button>
                        <!-- 2. 打卡管理 -->
                        <button id="tab-punch-mgmt-btn" data-i18n="TAB_PUNCH_MGMT"
                            class="py-2 px-4 rounded-full font-bold text-sm text-gray-600 bg-gray-200">打卡管理</button>
                        <!-- 3. 表單審核 -->
                        <button id="tab-form-review-btn" data-i18n="TAB_FORM_REVIEW"
                            class="py-2 px-4 rounded-full font-bold text-sm text-gray-600 bg-gray-200">表單審核</button>
                        <!-- 4. 排班 -->
                        <button id="tab-scheduling-btn" data-i18n="TAB_SCHEDULING" style="display: none;"
                            class="py-2 px-4 rounded-full font-bold text-sm text-gray-600 bg-gray-200">排班</button>
                    </div>
                </div>

                <section id="employee-mgmt-view" class="space-y-6" style="display: block;">

                    <div class="card p-6 mt-6">

                        <h2 data-i18n="EMPLOYEE_CALENDAR_TITLE"
                            class="text-xl font-bold text-gray-800 dark:text-white mb-4">
                            員工資料設定
                        </h2>
                        <div class="mb-4">
                            <label for="admin-select-employee-mgmt"
                                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                選擇員工:
                            </label>
                            <select id="admin-select-employee-mgmt"
                                class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                <option value="">-- 請選擇一位員工 --</option>
                            </select>
                        </div>

                        <div id="employee-detail-card" style="display: none;">
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div
                                    class="setting-card lg:col-span-2 bg-white dark:bg-gray-900 rounded-2xl shadow-lg p-6 hover:shadow-xl transition-shadow duration-300">
                                    <div
                                        class="flex items-center mb-6 border-b border-gray-200 dark:border-gray-700 pb-6">
                                        <img id="mgmt-employee-avatar"
                                            src="https://placehold.co/80x80/E0F2FE/1E3A8A?text=User"
                                            onerror="this.onerror=null;this.src='https://placehold.co/80x80/E0F2FE/1E3A8A?text=User'"
                                            alt="Employee Avatar"
                                            class="w-20 h-20 rounded-full object-cover mr-6 border-4 border-indigo-400 dark:border-indigo-500 shadow-lg flex-shrink-0 ring-2 ring-indigo-200 dark:ring-indigo-700">
                                        <div class="truncate flex-grow">
                                            <h4 class="text-2xl font-bold text-gray-900 dark:text-white truncate"
                                                id="mgmt-employee-name">
                                                員工姓名: N/A
                                            </h4>
                                            <p class="text-base font-mono text-gray-500 dark:text-gray-400 mt-2"
                                                style="display: none;" id="mgmt-employee-id">ID: N/A</p>
                                        </div>
                                    </div>
                                    <div class="flex flex-col gap-4">
                                        <div
                                            class="info-item bg-gradient-to-br from-yellow-50 to-yellow-100 dark:from-gray-800 dark:to-gray-700 p-4 rounded-xl shadow-md border-l-4 border-yellow-500">
                                            <p class="text-base font-semibold text-yellow-800 dark:text-yellow-300 flex items-center"
                                                data-i18n="SENIORITY">
                                                <i class="fas fa-crown mr-2 text-yellow-600 dark:text-yellow-400"></i>
                                                年資
                                            </p>
                                            <p class="text-3xl font-extrabold text-yellow-700 dark:text-yellow-200 mt-2"
                                                id="mgmt-employee-seniority">
                                                N/A
                                            </p>
                                        </div>

                                        <div
                                            class="info-item bg-gradient-to-br from-blue-50 to-blue-100 dark:from-gray-800 dark:to-gray-700 p-4 rounded-xl shadow-md border-l-4 border-blue-500">
                                            <p class="text-base font-semibold text-blue-800 dark:text-blue-300 flex items-center"
                                                data-i18n="JOIN_DATE">
                                                <i
                                                    class="far fa-calendar-alt mr-2 text-blue-600 dark:text-blue-400"></i>
                                                入職日期
                                            </p>
                                            <p class="text-2xl font-bold text-blue-700 dark:text-blue-200 mt-2"
                                                id="mgmt-employee-join-date">
                                                N/A
                                            </p>
                                        </div>

                                        <div
                                            class="info-item bg-gradient-to-br from-indigo-50 to-indigo-100 dark:from-gray-800 dark:to-gray-700 p-4 rounded-xl shadow-md border-l-4 border-indigo-500">
                                            <p class="text-base font-semibold text-indigo-800 dark:text-indigo-300 flex items-center"
                                                data-i18n="EMPLOYEE_TYPE">
                                                <i
                                                    class="fas fa-briefcase mr-2 text-indigo-600 dark:text-indigo-400"></i>
                                                職務狀態
                                            </p>
                                            <p class="text-xl font-bold text-indigo-700 dark:text-indigo-200 mt-2">
                                                <span
                                                    class="px-3 py-1 bg-indigo-200 text-indigo-900 dark:bg-indigo-700 dark:text-indigo-100 rounded-full text-sm font-semibold uppercase tracking-wide shadow-sm">
                                                    正式員工
                                                </span>
                                            </p>
                                        </div>

                                    </div>
                                </div>


                                <div
                                    class="setting-card lg:col-span-2 bg-white dark:bg-gray-900 rounded-2xl shadow-lg p-6 hover:shadow-xl transition-shadow duration-300">
                                    <h5 class="setting-title text-xl font-bold text-gray-800 dark:text-white mb-4 flex items-center"
                                        data-i18n="PERMISSION_ACCOUNT_SETTINGS">
                                        <i class="fas fa-shield-alt mr-2 text-indigo-600 dark:text-indigo-400"></i>
                                        權限設定與帳號控制
                                    </h5>

                                    <div class="space-y-4">
                                        <div
                                            class="flex justify-between items-center p-4 rounded-xl bg-gradient-to-br from-yellow-50 to-yellow-100 dark:from-gray-800 dark:to-gray-700 shadow-md">
                                            <label
                                                class="setting-label text-base font-semibold text-yellow-800 dark:text-yellow-300"
                                                data-i18n="IS_ADMIN">管理員權限:</label>
                                            <label class="relative inline-flex items-center cursor-pointer">
                                                <input type="checkbox" id="toggle-admin" class="sr-only peer"
                                                    onchange="toggleAdminStatus(currentManagingEmployee.userId, this.checked)">
                                                <div
                                                    class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-yellow-300 dark:peer-focus:ring-yellow-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-yellow-600">
                                                </div>
                                                <span class="ms-3 text-sm font-medium text-gray-900 dark:text-gray-300"
                                                    id="admin-status">關閉</span>
                                            </label>
                                        </div>
                                        <div
                                            class="flex justify-between items-center p-4 rounded-xl bg-gradient-to-br from-green-50 to-green-100 dark:from-gray-800 dark:to-gray-700 shadow-md">
                                            <label
                                                class="setting-label text-base font-semibold text-green-800 dark:text-green-300"
                                                data-i18n="ACCOUNT_STATUS">帳號啟用狀態:</label>
                                            <label class="relative inline-flex items-center cursor-pointer">
                                                <input type="checkbox" id="toggle-active" class="sr-only peer"
                                                    onchange="toggleAccountStatus(currentManagingEmployee.userId, this.checked)">
                                                <div
                                                    class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 dark:peer-focus:ring-green-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-green-600">
                                                </div>
                                                <span class="ms-3 text-sm font-medium text-gray-900 dark:text-gray-300"
                                                    id="active-status">關閉</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <div
                                    class="setting-card lg:col-span-2 bg-white dark:bg-gray-900 rounded-2xl shadow-lg p-6 hover:shadow-xl transition-shadow duration-300">
                                    <h5 class="setting-title text-xl font-bold text-gray-800 dark:text-white mb-4 flex items-center"
                                        data-i18n="LEAVE_SALARY_SETTINGS">
                                        <i class="fas fa-money-bill-wave mr-2 text-blue-600 dark:text-blue-400"></i>
                                        薪資設定
                                    </h5>
                                    <form id="form-leave-salary" onsubmit="handleLeaveSalaryUpdate(event)">
                                        <div class="space-y-4">
                                            <div>
                                                <label for="basic-salary"
                                                    class="setting-label block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
                                                    data-i18n="BASIC_SALARY">基本薪資 (NTD/月):</label>
                                                <input type="range" id="basic-salary" class="accent-blue-600 w-full h-2"
                                                    name="basicSalary" min="0" max="100000" step="100"
                                                    oninput="document.getElementById('salary-value').innerText = this.value">
                                                <div class="text-right text-sm text-gray-500 dark:text-gray-400 mt-1">
                                                    目前值: <span id="salary-value">0</span> NTD
                                                </div>
                                            </div>
                                            <button type="submit"
                                                class="w-full py-3 px-4 rounded-lg font-bold bg-blue-500 hover:bg-blue-600 text-white shadow-md transition duration-150"
                                                data-i18n="BTN_SAVE">
                                                儲存設定
                                            </button>
                                        </div>
                                    </form>
                                </div>

                                <div
                                    class="setting-card lg:col-span-2 bg-white dark:bg-gray-900 rounded-2xl shadow-lg p-6 hover:shadow-xl transition-shadow duration-300">
                                    <h5 class="setting-title text-xl font-bold text-gray-800 dark:text-white mb-4 flex items-center"
                                        data-i18n="PUNCH_POLICY_SETTINGS">
                                        <i class="fas fa-map-marker-alt mr-2 text-indigo-600 dark:text-indigo-400"></i>
                                        打卡政策設定
                                    </h5>
                                    <form id="form-punch-policy" onsubmit="handlePunchPolicyUpdate(event)">
                                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                            <div
                                                class="flex items-center p-4 rounded-xl bg-gradient-to-br from-indigo-50 to-indigo-100 dark:from-gray-800 dark:to-gray-700 shadow-md">
                                                <input type="checkbox" id="require-gps" name="requireGps"
                                                    class="checkbox-field w-5 h-5 text-indigo-600 dark:text-indigo-400 rounded focus:ring-indigo-500 dark:focus:ring-indigo-400">
                                                <label for="require-gps"
                                                    class="ml-3 text-base font-medium text-indigo-800 dark:text-indigo-300"
                                                    data-i18n="REQUIRE_GPS"> GPS 定位</label>
                                            </div>
                                            <div
                                                class="flex items-center p-4 rounded-xl bg-gradient-to-br from-indigo-50 to-indigo-100 dark:from-gray-800 dark:to-gray-700 shadow-md">
                                                <input type="checkbox" id="allow-manual-adjust" name="allowManualAdjust"
                                                    class="checkbox-field w-5 h-5 text-indigo-600 dark:text-indigo-400 rounded focus:ring-indigo-500 dark:focus:ring-indigo-400">
                                                <label for="allow-manual-adjust"
                                                    class="ml-3 text-base font-medium text-indigo-800 dark:text-indigo-300"
                                                    data-i18n="ALLOW_MANUAL_ADJUST">Wifi BSSID</label>
                                            </div>
                                        </div>
                                        <button type="submit"
                                            class="mt-6 py-3 px-4 rounded-lg font-bold bg-indigo-500 hover:bg-indigo-600 text-white shadow-md w-full transition duration-150"
                                            data-i18n="BTN_SAVE">
                                            儲存政策
                                        </button>
                                    </form>
                                </div>

                            </div>
                        </div>

                        <div id="mgmt-placeholder" style="display: block;"
                            class="mb-4 text-center py-10 dark:text-gray-300 bg-gray-50 dark:bg-gray-800 rounded-xl shadow-inner">
                            <i class="fas fa-info-circle text-3xl text-indigo-400 mb-2"></i>
                            <p class="font-semibold" data-i18n="MSG_PLEASE_SELECT_EMPLOYEE">請先從上方選單選擇一位員工以查看或修改詳細設定。</p>
                            <p class="text-sm mt-1 text-gray-500">（資料將自動載入）</p>
                        </div>
                    </div>

                    <div class="card p-6 mt-6">
                        <h2 data-i18n="EMPLOYEE_CALENDAR_TITLE"
                            class="text-xl font-bold text-gray-800 dark:text-white mb-4">員工日曆檢視</h2>
                        <div class="mb-4">
                            <label for="admin-select-employee"
                                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">選擇員工:</label>
                            <select id="admin-select-employee"
                                class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                <option value="">-- 請選擇一位員工 --</option>
                            </select>
                        </div>

                        <div id="admin-employee-calendar-card" style="display: none;">
                            <div class="flex justify-between items-center mb-4">
                                <button id="admin-prev-month-btn" class="p-2 text-blue-600 dark:text-blue-400">&lt;
                                    上個月</button>
                                <h3 id="admin-current-month-display" class="text-lg font-semibold dark:text-white"></h3>
                                <button id="admin-next-month-btn" class="p-2 text-blue-600 dark:text-blue-400">下個月
                                    &gt;</button>
                            </div>
                            <div id="admin-calendar-grid" class="grid grid-cols-7 gap-1 text-center text-sm">
                                <div class="font-bold text-red-600 dark:text-red-400">日</div>
                                <div class="font-bold">一</div>
                                <div class="font-bold">二</div>
                                <div class="font-bold">三</div>
                                <div class="font-bold">四</div>
                                <div class="font-bold">五</div>
                                <div class="font-bold text-blue-600 dark:text-blue-400">六</div>
                            </div>

                            <p id="admin-calendar-info" class="text-sm text-gray-500 mt-4 dark:text-gray-400"></p>
                            <!-- 在管理員日曆 HTML 中，放在日曆格子之後 -->
                            <button id="export-admin-month-excel-btn" class="mt-2 w-full py-2 px-3 rounded-lg
                                       bg-green-100 text-green-800
                                       dark:bg-green-600 dark:text-white
                                       border border-green-200 dark:border-green-700
                                       text-sm font-medium shadow-sm
                                       hover:bg-green-200 dark:hover:bg-green-700
                                       focus:outline-none focus:ring-2 focus:ring-green-400">
                                匯出月曆 Excel
                            </button>
                            <button id="toggle-admin-salary-btn"
                                class="mt-4 mb-2 w-full text-left px-3 py-2 rounded-lg bg-gray-50 dark:bg-gray-700 text-sm font-medium"
                                aria-expanded="false" type="button">
                                顯示月薪摘要 ▼
                            </button>
                            <div id="admin-monthly-salary-display"
                                class="mt-2 p-3 bg-gray-100 dark:bg-gray-600 rounded-lg" style="display: none;">
                            </div>

                        </div>

                        <div id="admin-daily-records-card" class="card p-6 mt-6" style="display: none;">
                            <h3 id="admin-daily-records-title" class="text-xl font-bold dark:text-white mb-4"></h3>

                            <ul id="admin-daily-records-list" class="space-y-3">
                            </ul>

                            <div id="admin-records-loading" style="display: none;"
                                class="text-center text-gray-500 py-4">
                                正在載入紀錄...</div>
                            <div id="admin-daily-records-empty" style="display: none;"
                                class="text-center text-gray-500 py-4">該日沒有打卡紀錄。</div>
                        </div>
                    </div>
                </section>

                <section id="punch-mgmt-view" class="space-y-6" style="display: none;">
                    <div class="card p-6 mt-6">
                        <h2 data-i18n="ADD_LOCATION_TITLE"
                            class="text-xl font-bold text-gray-800 mb-2  dark:text-white mb-1">新增打卡地點</h2>
                        <p data-i18n="ADD_LOCATION_DESCRIPTION" class="text-gray-500 mb-4">輸入地點名稱，並使用您的當前位置作為經緯度。</p>

                        <!-- 地標搜尋（Admin 新增地點） -->
                        <div id="admin-map-search" class="mb-3">
                            <label for="admin-map-search-input" class="sr-only">搜尋地標</label>
                            <div class="relative">
                                <input id="admin-map-search-input" type="text" placeholder="搜尋地標或地址..."
                                    autocomplete="off"
                                    class="w-full py-2 px-3 rounded-md border border-gray-300 bg-white dark:bg-gray-800 dark:border-gray-600 dark:text-white" />
                                <button id="admin-map-search-clear"
                                    class="absolute right-2 top-1/2 transform -translate-y-1/2 text-sm text-gray-500"
                                    aria-label="清除搜尋" style="display:none">✕</button>
                            </div>
                            <ul id="admin-map-search-results" class="admin-map-search-results mt-1" role="listbox"
                                aria-label="搜尋結果"></ul>
                        </div>

                        <!-- Admin Add Location Map -->
                        <div id="admin-add-location-map"
                            class="w-full h-64 rounded-lg mb-4 bg-gray-200 dark:bg-gray-800 relative">
                            <!-- 覆蓋層：地圖載入中（會在 JS 中隱藏） -->
                            <div id="admin-map-loading" class="admin-map-loading text-sm">地圖載入中...</div>
                        </div>

                        <div class="space-y-4">
                            <div>
                                <label data-i18n="LOCATION_NAME_LABEL" for="location-name"
                                    class="block text-sm font-medium text-gray-700">地點名稱</label>
                                <input type="text" id="location-name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm
                                    dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                            </div>
                            <div>
                                <label data-i18n="COORDINATES_LAT_LNG_LABEL"
                                    class="block text-sm font-medium text-gray-700">經緯度 (Latitude / Longitude)</label>
                                <div class="mt-1 flex space-x-2">
                                    <input type="text" id="location-lat" placeholder="緯度" readonly class="block w-1/2 rounded-md border-gray-300 bg-gray-100 shadow-sm sm:text-sm
                                        dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                    <input type="text" id="location-lng" placeholder="經度" readonly class="block w-1/2 rounded-md border-gray-300 bg-gray-100 shadow-sm sm:text-sm
                                        dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                </div>
                            </div>

                            <!-- 新增：設定打卡地點範圍（公尺） -->
                            <div>
                                <label for="location-radius-slider"
                                    class="block text-sm font-medium text-gray-700">打卡範圍</label>
                                <div class="mt-2 flex items-center space-x-3">
                                    <input id="location-radius-slider" type="range" min="10" max="500" step="10"
                                        value="100" class="w-full" />
                                    <span id="location-radius-display"
                                        class="w-20 text-sm text-gray-700 dark:text-gray-200 text-right">50 m</span>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">拖移滑桿以調整允許打卡的半徑（公尺）。</p>
                            </div>

                            <button data-i18n="GET_LOCATION_BTN" id="get-location-btn"
                                class="w-full py-2 px-4 rounded-lg font-bold btn-secondary">取得當前位置</button>
                            <div id="add-location-wrapper" class="relative">
                                <button data-i18n="ADD_LOCATION_BTN" id="add-location-btn"
                                    class="w-full py-2 px-4 rounded-lg font-bold btn-primary" disabled>新增地點</button>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="form-review-view" class="space-y-6" style="display: none;">
                    <div class="card p-6">
                        <div class="flex justify-between items-center mb-1">
                            <h2 data-i18n="PENDING_REQUESTS_TITLE"
                                class="text-xl font-bold text-gray-800 dark:text-white">
                                待審核請求</h2>
                            <button id="toggle-requests-btn"
                                class="text-gray-600 dark:text-gray-400 p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-transform">
                                <span id="toggle-requests-icon">▼</span>
                            </button>
                        </div>
                        <p data-i18n="PENDING_REQUESTS_DESCRIPTION" class="text-gray-500 mb-4">請處理員工提出的補打卡或虛擬卡請求。</p>
                        <div id="pending-requests-content">
                            <div id="pending-requests-container">
                                <div id="requests-loading" data-i18n="REQUESTS_LOADING"
                                    class="text-center text-gray-500 py-4">正在載入請求...</div>
                                <div id="requests-empty" class="text-center text-green-600 bg-green-50 p-4 rounded-lg"
                                    style="display: none;">
                                    <p data-i18n="REQUESTS_EMPTY_TITLE" class="font-semibold">太棒了！</p>
                                    <p data-i18n="REQUESTS_EMPTY_MESSAGE">目前沒有任何待審核的請求。</p>
                                </div>
                                <ul id="pending-requests-list" class="space-y-3"></ul>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="scheduling-view" class="space-y-6" style="display: none;">
                    <div class="card p-6">
                        <h2 class="text-xl font-bold text-gray-800 mb-1 dark:text-white mb-1">
                            未解鎖功能</h2>
                        <p class="text-gray-500 mb-4">請聯絡開發人員</p>
                    </div>
                    <div class="card p-6 mt-6" style="display: none;">
                        <h2 data-i18n="API_TEST_TITLE"
                            class="text-xl font-bold text-gray-800 mb-2  dark:text-white mb-1">
                            API 測試區</h2>
                        <p data-i18n="API_TEST_DESCRIPTION" class="text-gray-500 mb-4">點擊下方按鈕以測試新的 API 功能。</p>
                        <div>
                            <button data-i18n="API_TEST_BTN" id="test-api-btn"
                                class="w-full py-2 px-4 rounded-lg font-bold btn-primary">測試 API</button>
                        </div>
                    </div>
                </section>

            </section>
        </div>
        <footer class="mt-8 text-center text-sm text-gray-500">
            <p>
                <span data-i18n="APP_TITLE">零點考勤系統</span> v1.0 |
                <span class="text-gray-400">
                    <span data-i18n="FOOTER_CREDITS_PREFIX">由</span>
                    <a href="https://github.com/0rigind1865-bit" class="hover:underline">0J</a>
                    <span data-i18n="FOOTER_CREDITS_SUFFIX">製作</span> |
                    <a data-i18n="FOOTER_SPONSOR" href="https://buymeacoffee.com/0rigind186u"
                        class="hover:underline">點此贊助此專案</a>
                </span>
            </p>
            <p class="text-xs text-gray-400 mt-1">
                <span data-i18n="FOOTER_OPEN_SOURCE">這是一個開源專案，歡迎貢獻。</span>
            </p>
        </footer>
    </div>
    <!-- 作者資訊區塊 -->

    <!-- Notification -->
    <div id="notification" class="notification">
        <p id="notification-message"></p>
    </div>

    <script src="js/config.js"></script>
    <script src="js/state.js"></script>
    <script src="js/core.js"></script>
    <script src="js/app.js"></script>
    <script src="js/punch.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/location.js"></script>
    <!-- SheetJS for Excel export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="js/admin.js"></script>

    <!-- Floating LINE button (樣式與行為移到 compiled.css / js/app.js) -->
    <button id="floating-line-btn" class="floating-line-btn" aria-label="加入員工 LINE 頻道" title="長按可隱藏"
        data-line-url="https://lin.ee/vOQCBjv">
        💬
    </button>
</body>

</html>
